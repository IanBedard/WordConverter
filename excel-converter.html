<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Excel Converter - Modern UI</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <!-- Custom Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    
    <link href="./style.css" rel="stylesheet">
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="bi bi-magic me-2"></i>Converter Tools
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">

                    <li class="nav-item">
                        <a class="nav-link" href="index.html">
                            <i class="bi bi-file-word me-1"></i>DOCX → HTML
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="#">
                            <i class="bi bi-table me-1"></i>XLSX → JSON
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Header Section -->
        <div class="header-section">
            <h1 class="app-title">
                <i class="bi bi-file-excel text-success me-2"></i>Excel to JSON Converter
            </h1>
            <p class="app-subtitle">
                Transform your Excel spreadsheets into clean JSON format with advanced processing options and real-time preview.
            </p>
        </div>

        <!-- Main Content Card -->
        <div class="content-card">
            <!-- File Upload Section -->
            <div class="upload-section">
                <div class="file-input-wrapper">
                    <input type="file" id="input" class="file-input" accept=".xlsx,.xls">
                    <div class="file-input-button" id="file-input-display">
                        <i class="bi bi-cloud-upload fs-2"></i>
                        <div>
                            <div class="fw-bold">Choose an Excel file</div>
                            <div class="small">Drag and drop or click to browse (.xlsx, .xls)</div>
                        </div>
                    </div>
                </div>
                
                <div class="progress-container">
                    <div class="progress">
                        <div class="progress-bar" style="width: 0%"></div>
                    </div>
                </div>
                
                <div class="status-message status-success" id="success-message">
                    <i class="bi bi-check-circle-fill"></i>
                    <span>Excel file processed successfully!</span>
                </div>
                
                <div class="status-message status-error" id="error-message">
                    <i class="bi bi-exclamation-circle-fill"></i>
                    <span>Error processing Excel file. Please try again.</span>
                </div>
            </div>

            <!-- Tabs -->
            <div class="custom-tabs">
                <ul class="nav nav-tabs" id="outputTabs">
                    <li class="nav-item">
                        <button class="nav-link active" id="json-tab" data-bs-toggle="tab" data-bs-target="#json-pane">
                            <i class="bi bi-braces me-2"></i>JSON Data
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" id="preview-tab" data-bs-toggle="tab" data-bs-target="#preview-pane">
                            <i class="bi bi-table me-2"></i>Table Preview
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" id="settings-tab" data-bs-toggle="tab" data-bs-target="#settings-pane">
                            <i class="bi bi-gear me-2"></i>Settings
                        </button>
                    </li>
                </ul>
            </div>

            <!-- Tab Content -->
            <div class="tab-content">
                <!-- JSON Data Tab -->
                <div class="tab-pane fade show active" id="json-pane">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h4 class="mb-0">
                            <i class="bi bi-braces text-primary me-2"></i>Generated JSON Data
                        </h4>
                        <div class="action-buttons">
                            <button class="btn-modern btn-secondary-modern" id="format-json">
                                <i class="bi bi-braces"></i>Format JSON
                            </button>
                            <button class="btn-modern btn-primary-modern" id="dl-json">
                                <i class="bi bi-clipboard"></i>Copy JSON
                            </button>
                        </div>
                    </div>
                    <textarea 
                        class="form-control code-editor" 
                        id="json-data" 
                        rows="20" 
                        placeholder="Your converted JSON data will appear here..."
                        spellcheck="false"
                    ></textarea>
                </div>

                <!-- Table Preview Tab -->
                <div class="tab-pane fade" id="preview-pane">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h4 class="mb-0">
                            <i class="bi bi-table text-primary me-2"></i>Table Preview
                        </h4>
                        <div class="action-buttons">
                            <button class="btn-modern btn-secondary-modern" id="refresh-preview">
                                <i class="bi bi-arrow-clockwise"></i>Refresh
                            </button>
                            <button class="btn-modern btn-secondary-modern" id="download-csv">
                                <i class="bi bi-download"></i>Download CSV
                            </button>
                        </div>
                    </div>
                    <div class="preview-container" id="table-output">
                        <div class="text-center text-muted py-5">
                            <i class="bi bi-table fs-1 mb-3 d-block"></i>
                            <p>Upload an Excel file to see the table preview here</p>
                        </div>
                    </div>
                </div>

                <!-- Settings Tab -->
                <div class="tab-pane fade" id="settings-pane">
                    <h4 class="mb-4">
                        <i class="bi bi-gear text-primary me-2"></i>Processing Options
                    </h4>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card border-0 shadow-sm mb-4">
                                <div class="card-body">
                                    <h5 class="card-title">
                                        <i class="bi bi-table text-primary me-2"></i>Data Processing
                                    </h5>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="include-headers" checked>
                                        <label class="form-check-label" for="include-headers">
                                            Use first row as headers
                                        </label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="skip-empty-rows" checked>
                                        <label class="form-check-label" for="skip-empty-rows">
                                            Skip empty rows
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="trim-whitespace" checked>
                                        <label class="form-check-label" for="trim-whitespace">
                                            Trim whitespace from values
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="card border-0 shadow-sm mb-4">
                                <div class="card-body">
                                    <h5 class="card-title">
                                        <i class="bi bi-code-slash text-primary me-2"></i>Output Options
                                    </h5>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="pretty-format" checked>
                                        <label class="form-check-label" for="pretty-format">
                                            Pretty format JSON output
                                        </label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="convert-numbers">
                                        <label class="form-check-label" for="convert-numbers">
                                            Auto-convert numeric values
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="convert-dates">
                                        <label class="form-check-label" for="convert-dates">
                                            Auto-convert date values
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="action-buttons justify-content-center">
                        <button class="btn-modern btn-primary-modern" id="reprocess-data">
                            <i class="bi bi-play-circle"></i>Reprocess with Settings
                        </button>
                        <button class="btn-modern btn-secondary-modern" id="reset-settings">
                            <i class="bi bi-arrow-counterclockwise"></i>Reset to Defaults
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/read-excel-file@4.1.0/bundle/read-excel-file.min.js"></script>
    
    <script>
        // Enhanced UI interactions
        document.addEventListener('DOMContentLoaded', function() {
            const fileInput = document.getElementById('input');
            const fileInputDisplay = document.getElementById('file-input-display');
            const progressContainer = document.querySelector('.progress-container');
            const progressBar = document.querySelector('.progress-bar');
            const successMessage = document.getElementById('success-message');
            const errorMessage = document.getElementById('error-message');

            // File input handling with modern UI feedback
            fileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    fileInputDisplay.classList.add('has-file');
                    fileInputDisplay.innerHTML = `
                        <i class="bi bi-file-earmark-check fs-2"></i>
                        <div>
                            <div class="fw-bold">${file.name}</div>
                            <div class="small">${(file.size / 1024 / 1024).toFixed(2)} MB</div>
                        </div>
                    `;
                    showProgress();
                    processExcelFile(file);
                } else {
                    resetFileInput();
                }
            });

            // Drag and drop functionality
            fileInputDisplay.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.style.borderColor = 'var(--primary-color)';
                this.style.background = 'rgba(99, 102, 241, 0.05)';
            });

            fileInputDisplay.addEventListener('dragleave', function(e) {
                e.preventDefault();
                this.style.borderColor = 'var(--border-color)';
                this.style.background = 'var(--light-color)';
            });

            fileInputDisplay.addEventListener('drop', function(e) {
                e.preventDefault();
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    fileInput.files = files;
                    fileInput.dispatchEvent(new Event('change'));
                }
                this.style.borderColor = 'var(--border-color)';
                this.style.background = 'var(--light-color)';
            });

            // Excel processing function with settings
            function processExcelFile(file) {
                readXlsxFile(file).then((data) => {
                    // Store raw data for reprocessing
                    window.rawExcelData = data;
                    processDataWithSettings(data);
                    
                    setTimeout(() => {
                        showSuccess();
                    }, 1000);
                }).catch(error => {
                    console.error('Error processing Excel file:', error);
                    showError();
                });
            }

            // Process data with current settings
            function processDataWithSettings(data) {
                const includeHeaders = document.getElementById('include-headers').checked;
                const skipEmptyRows = document.getElementById('skip-empty-rows').checked;
                const trimWhitespace = document.getElementById('trim-whitespace').checked;
                const prettyFormat = document.getElementById('pretty-format').checked;
                const convertNumbers = document.getElementById('convert-numbers').checked;
                const convertDates = document.getElementById('convert-dates').checked;

                let headers = [];
                let jsonObject = [];
                let tableHTML = '';

                // Filter empty rows if needed
                let processedData = data;
                if (skipEmptyRows) {
                    processedData = data.filter(row => row.some(cell => cell !== null && cell !== ''));
                }

                processedData.forEach((row, index) => {
                    if (index === 0 && includeHeaders) {
                        headers = row.map(header => trimWhitespace ? String(header).trim() : String(header));
                        // Create table header
                        tableHTML = '<table class="table table-striped table-hover"><thead class="table-dark"><tr>';
                        headers.forEach(header => {
                            tableHTML += `<th>${header}</th>`;
                        });
                        tableHTML += '</tr></thead><tbody>';
                    } else {
                        let temp = {};
                        let rowData = [];
                        
                        for (let x = 0; x < row.length; x++) {
                            let value = row[x];
                            
                            // Trim whitespace if needed
                            if (trimWhitespace && typeof value === 'string') {
                                value = value.trim();
                            }
                            
                            // Convert numbers if needed
                            if (convertNumbers && !isNaN(value) && value !== '') {
                                value = Number(value);
                            }
                            
                            // Convert dates if needed (basic date detection)
                            if (convertDates && typeof value === 'string' && isValidDate(value)) {
                                value = new Date(value).toISOString();
                            }
                            
                            if (includeHeaders && headers[x]) {
                                temp[headers[x]] = value;
                            } else {
                                temp[`column_${x + 1}`] = value;
                            }
                            rowData.push(value);
                        }
                        
                        jsonObject.push(temp);
                        
                        // Add table row
                        tableHTML += '<tr>';
                        rowData.forEach(cell => {
                            tableHTML += `<td>${cell !== null ? cell : ''}</td>`;
                        });
                        tableHTML += '</tr>';
                    }
                });

                tableHTML += '</tbody></table>';

                // Update JSON output
                const jsonString = prettyFormat ? 
                    JSON.stringify(jsonObject, null, 2) : 
                    JSON.stringify(jsonObject);
                document.getElementById('json-data').value = jsonString;
                
                // Update table preview
                document.getElementById('table-output').innerHTML = tableHTML;
            }

            // Helper function to detect valid dates
            function isValidDate(dateString) {
                const date = new Date(dateString);
                return date instanceof Date && !isNaN(date) && dateString.length > 8;
            }

            // Copy button with modern feedback
            document.getElementById('dl-json').addEventListener('click', async function() {
                const jsonData = document.getElementById('json-data').value;
                if (!jsonData) {
                    showToast('No JSON data to copy', 'warning');
                    return;
                }

                try {
                    await navigator.clipboard.writeText(jsonData);
                    showToast('JSON copied to clipboard!', 'success');
                    this.innerHTML = '<i class="bi bi-check"></i>Copied!';
                    setTimeout(() => {
                        this.innerHTML = '<i class="bi bi-clipboard"></i>Copy JSON';
                    }, 2000);
                } catch (err) {
                    showToast('Failed to copy to clipboard', 'error');
                }
            });

            // Refresh table preview button
            document.getElementById('refresh-preview').addEventListener('click', function() {
                if (window.rawExcelData) {
                    processDataWithSettings(window.rawExcelData);
                    showToast('Preview refreshed!', 'success');
                } else {
                    showToast('No data to refresh', 'warning');
                }
            });

            // Download CSV button
            document.getElementById('download-csv').addEventListener('click', function() {
                const jsonData = document.getElementById('json-data').value;
                if (!jsonData) {
                    showToast('No data to download', 'warning');
                    return;
                }

                try {
                    const data = JSON.parse(jsonData);
                    if (data.length === 0) {
                        showToast('No data to download', 'warning');
                        return;
                    }

                    // Convert JSON to CSV
                    const headers = Object.keys(data[0]);
                    let csv = headers.join(',') + '\n';
                    
                    data.forEach(row => {
                        const values = headers.map(header => {
                            let value = row[header];
                            if (typeof value === 'string' && value.includes(',')) {
                                value = `"${value}"`;
                            }
                            return value;
                        });
                        csv += values.join(',') + '\n';
                    });

                    // Download CSV file
                    const blob = new Blob([csv], { type: 'text/csv' });
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'converted_data.csv';
                    a.click();
                    window.URL.revokeObjectURL(url);

                    showToast('CSV downloaded successfully!', 'success');
                } catch (e) {
                    showToast('Error creating CSV file', 'error');
                }
            });

            // Reprocess data button
            document.getElementById('reprocess-data').addEventListener('click', function() {
                if (window.rawExcelData) {
                    processDataWithSettings(window.rawExcelData);
                    showToast('Data reprocessed with new settings!', 'success');
                } else {
                    showToast('No data to reprocess. Please upload a file first.', 'warning');
                }
            });

            // Reset settings button
            document.getElementById('reset-settings').addEventListener('click', function() {
                document.querySelectorAll('#settings-pane input[type="checkbox"]').forEach(checkbox => {
                    // Reset to default checked state
                    const defaultChecked = ['include-headers', 'skip-empty-rows', 'trim-whitespace', 'pretty-format'];
                    checkbox.checked = defaultChecked.includes(checkbox.id);
                });
                showToast('Settings reset to defaults', 'info');
            });

            function showProgress() {
                progressContainer.style.display = 'block';
                let progress = 0;
                const interval = setInterval(() => {
                    progress += Math.random() * 30;
                    if (progress > 100) {
                        progress = 100;
                        clearInterval(interval);
                        setTimeout(() => {
                            progressContainer.style.display = 'none';
                        }, 500);
                    }
                    progressBar.style.width = progress + '%';
                }, 200);
            }

            function showSuccess() {
                successMessage.style.display = 'flex';
                setTimeout(() => {
                    successMessage.style.display = 'none';
                }, 5000);
            }

            function showError() {
                errorMessage.style.display = 'flex';
                setTimeout(() => {
                    errorMessage.style.display = 'none';
                }, 5000);
            }

            function resetFileInput() {
                fileInputDisplay.classList.remove('has-file');
                fileInputDisplay.innerHTML = `
                    <i class="bi bi-cloud-upload fs-2"></i>
                    <div>
                        <div class="fw-bold">Choose an Excel file</div>
                        <div class="small">Drag and drop or click to browse (.xlsx, .xls)</div>
                    </div>
                `;
            }

            function showToast(message, type = 'info') {
                const toast = document.createElement('div');
                toast.className = `position-fixed top-0 end-0 m-3 p-3 rounded shadow toast-${type}`;
                toast.style.zIndex = '9999';
                toast.style.background = type === 'success' ? 'var(--success-color)' : 
                                       type === 'error' ? 'var(--danger-color)' : 
                                       type === 'warning' ? 'var(--warning-color)' : 'var(--primary-color)';
                toast.style.color = 'white';
                toast.textContent = message;
                
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.remove();
                }, 3000);
            }
        });
    </script>
</body>
</html>